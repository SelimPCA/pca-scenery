set_up:
  - reset_db

case:
  registration_form:
    !common-item
      ID: HARRY
      birth_date_year: "2010"
      user_email: !common-item EMAIL
      password1: !common-item PASSWORD
      password2: !common-item PASSWORD

scene: 
  method: POST
  url: app:register
  query_parameters:
    send_verif_email: 0
  data: !case registration_form
  directives:
    - status_code: 200
    - count_instances: 
        model: UserCustom
        n: 0

    # selim : mathématiquement celui du dessus ok
    # on testera plus finelement le message d'erreur du front avec les tests du front
    # - dom_element:
    #     find: 
    #       class: message
    #     text: "\n\nEn raison de l'article 8 du RGPD, pointcarre.app n'est pas encore disponible pour les mineurs de moins de 15 ans. \n            La fonctionnalité de recherche du consentement d'un parent sera implémentée au premier trimestre 2024.\n\n"
    #     attribute:
    #       name: class
    #       value:
    #         - message 
    #         - is-danger

